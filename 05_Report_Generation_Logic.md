05. Report Generation Logic & Delivery
Document ID: BE-02 Role: Final Output Production (The "Product") Tech Stack: React-PDF (@react-pdf/renderer), Chart.js (Node-canvas), AWS S3 (Storage), Resend (Email)

1. Generation Workflow (생성 흐름도)
보고서 생성은 **백엔드(FastAPI)**에서 일어나는 것이 아니라, **별도의 '리포트 워커(Report Worker)'**나 프론트엔드 서버 사이드에서 처리하는 것이 품질 관리에 좋습니다. (React 컴포넌트를 PDF로 굽기 때문)

코드 스니펫

graph TD
    A[Agent 6 (Report Writer)] -->|Final JSON| B{PDF Generator Service}
    
    subgraph "Asset Preparation"
        B --> C[Generate Chart Images]
        B --> D[Fetch 3D Snapshot (PNG)]
        C & D --> B
    end
    
    B -->|Render React Template| E[Binary PDF Data]
    E --> F[Upload to AWS S3]
    F -->|Public URL| G[Update Database Job Status]
    G --> H[Send Email Notification]
2. Input Data Schema (Agent 6 Output)
보고서 생성기가 받을 입력 데이터(JSON) 표준입니다. 이 데이터가 비어 있으면 보고서에 "N/A"가 찍히므로, Agent 6가 빈칸을 채우도록 강제해야 합니다.

JSON

{
  "meta": {
    "job_id": "job_123",
    "date": "2026-01-17",
    "user_org": "Syngene Intl."
  },
  "summary": {
    "grade": "B+", // S, A, B, C, F
    "verdict": "Conditional Go", // Go, No-Go, Conditional Go
    "verdict_color": "#FFC107", // Yellow
    "executive_summary": "LIV-1 targeting is promising, but the linker shows instability..."
  },
  "scores": {
    "efficacy": 85,
    "toxicity": 60,
    "patent": 90,
    "marketability": 70
  },
  "details": {
    "structure_analysis": "...",
    "toxicity_risks": ["Neutropenia", "Ocular Toxicity"],
    "patent_status": "Green (Expired)",
    "competitors": ["Merck (Phase 2)", "Seagen (Phase 1)"],
    "clinical_suggestion": "Start with 0.5 mg/kg dose..."
  }
}
3. PDF Layout & Design Template
보고서는 총 5~7페이지 분량의 Professional Consultant Style로 구성합니다.

Page 1: The Cover (표지)
Design: 딥 블루(Deep Blue) 배경의 고급스러운 표지.

Elements:

Large Title: "AI-Driven ADC Assessment Report"

Subtitle: {Target Name} + {Payload Name}

Client Name: Prepared for {User Organization}

Date: YYYY.MM.DD

Logo: ADC-GenAI Platform Logo (Bottom Center)

Page 2: Executive Summary (핵심 요약) - 가장 중요
바쁜 임원들은 이 페이지만 봅니다.

Top Section: Final Grade Badge (크게 B+ 표시).

Verdict Box: 신호등 색상으로 배경 처리된 결론 박스.

"판정: 조건부 진행 (Conditional Go)"

"이유: 효능은 탁월하나 독성 리스크가 발견됨."

Radar Chart: 5각 분석 차트 (효능, 독성, 물성, 특허, 사업성) 이미지 삽입.

Key Findings: 3줄 요약 (Bullet points).

Page 3: Scientific Assessment (과학적 분석)
3D Structure View:

Agent 1이 생성한 PDB 파일의 **스냅샷 이미지(PNG)**를 중앙에 배치.

캡션: "Red indicates the payload binding site."

Toxicity Table:

독성 예측 항목(LogP, TPSA 등)을 표(Table)로 정리.

위험 항목은 빨간색 텍스트로 강조.

Page 4: Market & IP Landscape (시장 및 특허)
Competitor Map: 경쟁사 3곳의 임상 단계 진행 상황을 막대 그래프로 표시.

Patent Status:

"Linker Patent: Expired (Safe)" ✅

"Payload Patent: Active until 2028 (Caution)" ⚠️

AI Recommendation: "GGFG 링커 대신 GFLG 사용 권장."

Page 5: Clinical Protocol Draft (임상 제안)
Phase 1 Synopsis:

Target Patient: HER2-low Expressing Breast Cancer.

Starting Dose: 0.5 mg/kg Q3W.

Biomarker: LIV-1 IHC 1+ or higher.

Footer (모든 페이지 공통)
Disclaimer: "This report is generated by AI and should be used for research purposes only."

Page Number: 1 / 5

4. Technical Implementation (기술 구현)
4.1 Library Choice: React-PDF vs Puppeteer
우리는 **@react-pdf/renderer**를 선택합니다.

이유: 서버에서 Headless Chrome(Puppeteer)을 띄우는 건 무겁고 느립니다. React-PDF는 리액트 컴포넌트를 바로 PDF 바이너리로 바꿔주므로 훨씬 빠르고 가볍습니다.

4.2 Handling Charts & Images
React-PDF는 차트 라이브러리를 직접 지원하지 않습니다. 따라서 이미지 변환 과정이 필요합니다.

Radar Chart: Node.js 환경에서 Chart.js + canvas 라이브러리를 이용해 차트를 그리고, 이를 Buffer 또는 Base64 Image로 변환하여 PDF에 삽입합니다.

3D Snapshot: 백엔드(Structure Agent)에서 PyMol 스크립트를 돌려 .png 파일을 생성해 S3에 올리고, 그 URL을 PDF에 넣습니다.

5. Delivery & Notification (배송)
5.1 Storage (S3)
Path: s3://adc-reports/{user_id}/{job_id}_report.pdf

Security: Pre-signed URL을 사용하여, 링크가 유출되어도 1시간 뒤에는 만료되도록 설정합니다.

5.2 Email Notification (Resend API)
보고서가 완성되면 연구원에게 "배달 완료" 메일을 보냅니다.

Subject: "✅ Analysis Complete: {Project_Name}"

Body:

"Dr. Kim, Your ADC simulation for LIV-1 + MMAE is ready. The AI predicts a B+ Grade. [Download Report PDF] (Button) Best, ADC Platform Team"

6. Development Checklist
[ ] React-PDF Template 디자인 (표지, 본문, 스타일링).

[ ] Chart Generation Utils 개발 (Node.js에서 차트를 이미지로 바꾸는 함수).

[ ] S3 Uploader 연동.

[ ] Email Template 작성 (Resend).

[ ] Disclaimer 법적 문구 검토 및 삽입.