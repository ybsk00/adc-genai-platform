<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ADC Analysis Report - {{ job_id }}</title>
</head>

<body>
    <!-- 헤더 -->
    <div class="header">
        <div class="logo">ADC-GenAI Platform</div>
        <h1>ADC 분석 리포트</h1>
        <p>Report ID: {{ job_id }} | 생성일: {{ generated_at }}</p>
        {% if user_name != "Anonymous" %}
        <p>{{ user_name }} | {{ user_org }}</p>
        {% endif %}
    </div>

    <!-- 요약 섹션 -->
    <div class="summary-box">
        <table style="border: none;">
            <tr>
                <td style="width: 120px; text-align: center; border: none;">
                    <div class="grade-box" style="background: {{ grade_color }};">
                        {{ grade }}
                    </div>
                </td>
                <td style="border: none; vertical-align: top;">
                    <h3 style="margin-top: 0;">종합 평가</h3>
                    <p>
                        <span class="badge"
                            style="background: {{ recommendation_badge.bg }}; color: {{ recommendation_badge.text }}; border: 1px solid {{ recommendation_badge.border }};">
                            {{ recommendation }}
                        </span>
                    </p>
                    <p>{{ executive_summary }}</p>
                </td>
            </tr>
        </table>
    </div>

    <!-- ADC 구성 정보 -->
    <h2>1. ADC 구성 (Configuration)</h2>
    <table>
        <tr>
            <th style="width: 30%;">항목</th>
            <th>값</th>
        </tr>
        <tr>
            <td>타겟 (Target)</td>
            <td><strong>{{ input.target_name }}</strong></td>
        </tr>
        <tr>
            <td>항체 (Antibody)</td>
            <td>{{ input.antibody_type }}</td>
        </tr>
        <tr>
            <td>약물 (Payload)</td>
            <td>{{ input.payload_id | upper }}</td>
        </tr>
        <tr>
            <td>링커 (Linker)</td>
            <td>{{ input.linker_id }}</td>
        </tr>
        <tr>
            <td>DAR</td>
            <td>{{ input.dar }}</td>
        </tr>
    </table>

    <!-- 점수 대시보드 -->
    <h2>2. 평가 점수 (Scores)</h2>
    <table>
        <tr>
            <th>항목</th>
            <th style="width: 50%;">점수</th>
            <th style="width: 80px;">값</th>
        </tr>
        {% for key, value in scores.items() %}
        <tr>
            <td>
                {% if key == 'efficacy' %}효능 (Efficacy)
                {% elif key == 'toxicity' %}독성 안전성 (Toxicity Safety)
                {% elif key == 'properties' %}물성 (Properties)
                {% elif key == 'patent' %}특허 (Patent)
                {% elif key == 'market' %}시장성 (Market)
                {% else %}{{ key }}
                {% endif %}
            </td>
            <td>
                <div class="score-bar">
                    <div class="score-fill"
                        style="width: {{ value }}%; background: {% if value >= 80 %}#22c55e{% elif value >= 60 %}#eab308{% else %}#ef4444{% endif %};">
                    </div>
                </div>
            </td>
            <td style="text-align: center; font-weight: 600;">{{ value }}/100</td>
        </tr>
        {% endfor %}
    </table>

    <!-- 구조 분석 -->
    {% if structure_analysis %}
    <h2>3. 구조 분석 (Structure Analysis)</h2>
    <table>
        <tr>
            <td>안정성 점수</td>
            <td><strong>{{ structure_analysis.stability_score }}/100</strong></td>
        </tr>
        <tr>
            <td>응집 리스크</td>
            <td>
                <span
                    class="badge {% if structure_analysis.aggregation_risk == 'Low' %}risk-low{% elif structure_analysis.aggregation_risk == 'Medium' %}risk-medium{% else %}risk-high{% endif %}">
                    {{ structure_analysis.aggregation_risk }}
                </span>
            </td>
        </tr>
        <tr>
            <td>접합 부위</td>
            <td>{{ structure_analysis.conjugation_sites | join(', ') }}</td>
        </tr>
    </table>
    {% endif %}

    <!-- 독성 분석 -->
    {% if toxicity_risks %}
    <h2>4. 독성 분석 (Toxicity Assessment)</h2>
    <table>
        <tr>
            <th>리스크 유형</th>
            <th>심각도</th>
            <th>신뢰도</th>
            <th>근거</th>
        </tr>
        {% for risk in toxicity_risks %}
        <tr>
            <td>{{ risk.risk_type }}</td>
            <td>
                <span
                    class="badge {% if risk.severity == 'High' %}risk-high{% elif risk.severity == 'Medium' %}risk-medium{% else %}risk-low{% endif %}">
                    {{ risk.severity }}
                </span>
            </td>
            <td>{{ (risk.confidence * 100) | int }}%</td>
            <td style="font-size: 9pt;">{{ risk.evidence }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- 특허 분석 -->
    {% if patent_landscape %}
    <h2>5. 특허 현황 (Patent Landscape)</h2>
    <table>
        <tr>
            <th>특허 번호</th>
            <th>제목</th>
            <th>상태</th>
            <th>만료일</th>
            <th>리스크</th>
        </tr>
        {% for patent in patent_landscape %}
        <tr>
            <td>{{ patent.patent_id }}</td>
            <td style="font-size: 10pt;">{{ patent.title }}</td>
            <td>{{ patent.status }}</td>
            <td>{{ patent.expiry_date or '-' }}</td>
            <td>
                <span
                    class="badge {% if patent.risk_level == 'High' %}risk-high{% elif patent.risk_level == 'Medium' %}risk-medium{% else %}risk-low{% endif %}">
                    {{ patent.risk_level }}
                </span>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- 경쟁사 분석 -->
    {% if competitors %}
    <h2>6. 경쟁사 분석 (Competitive Landscape)</h2>
    <table>
        <tr>
            <th>회사</th>
            <th>약물명</th>
            <th>타겟</th>
            <th>개발 단계</th>
            <th>비고</th>
        </tr>
        {% for comp in competitors %}
        <tr>
            <td>{{ comp.company }}</td>
            <td>{{ comp.drug_name or '-' }}</td>
            <td>{{ comp.target }}</td>
            <td>{{ comp.phase }}</td>
            <td style="font-size: 9pt;">{{ comp.notes or '-' }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- 임상 권고 -->
    {% if clinical_protocol %}
    <h2>7. 임상 개발 권고 (Clinical Recommendations)</h2>
    <table>
        <tr>
            <td>권장 시작 용량</td>
            <td><strong>{{ clinical_protocol.recommended_starting_dose }}</strong></td>
        </tr>
        <tr>
            <td>용량 증량 설계</td>
            <td>{{ clinical_protocol.dose_escalation_scheme }}</td>
        </tr>
        <tr>
            <td>1차 평가변수</td>
            <td>{{ clinical_protocol.primary_endpoints | join(', ') }}</td>
        </tr>
        <tr>
            <td>바이오마커</td>
            <td>{{ clinical_protocol.biomarkers | join(', ') }}</td>
        </tr>
        <tr>
            <td>예상 환자 수</td>
            <td>{{ clinical_protocol.estimated_patients }}</td>
        </tr>
        <tr>
            <td>예상 기간</td>
            <td>{{ clinical_protocol.estimated_duration }}</td>
        </tr>
    </table>

    <h3>주요 제외 기준</h3>
    <ul>
        {% for exclusion in clinical_protocol.key_exclusions %}
        <li>{{ exclusion }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <!-- 면책조항 -->
    <div class="disclaimer">
        <strong>⚠️ 면책조항:</strong> 본 리포트는 AI 분석 결과이며, 최종 의사결정 전 전문가 검토가 필요합니다.
        임상 적용 시 반드시 규제 기관의 지침을 따르십시오.
    </div>

    <!-- 푸터 -->
    <div class="footer">
        <p>Generated by ADC-GenAI Platform | Powered by LangGraph & GPT-4o</p>
        <p>© 2026 ADC-GenAI. All rights reserved.</p>
    </div>
</body>

</html>